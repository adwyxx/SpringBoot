## 面向切面编程：Aspect Oriented Programming
### 一、什么是AOP
### 1. 基本概念
Aspect Oriented Programming  面向切面编程。解耦是程序员编码开发过程中一直追求的。AOP也是为了解耦所诞生。
具体思想是：定义一个切面，在切面的纵向定义处理方法，处理完成之后，回到横向业务流。
AOP 在Spring框架中被作为核心组成部分之一，的确Spring将AOP发挥到很强大的功能。最常见的就是事务控制。
AOP 主要是利用代理模式的技术来实现的。
### 2. AOP的优点
> 利用AOP可以对业务逻辑的各个部分进行隔离，从而使得业务逻辑各部分之间的耦合度降低，提高程序的可重用性，同时提高了开发的效率。

##### 主要功能：
日志记录，性能统计，安全控制，事务处理，异常处理等等。
##### 主要意图：
将日志记录，性能统计，安全控制，事务处理，异常处理等代码从业务逻辑代码中划分出来，通过对这些行为的分离，我们希望可以将它们独立到非业务逻辑的方法中，进而改变这些行为的时候不影响业务逻辑的代码。
 
##### AOP之所以能得到广泛认可，主要是因为它将应用系统拆分分了2个部分：
> 核心业务逻辑（Core business concerns）及横向的通用逻辑，也就是所谓的切面Crosscutting enterprise concerns。

例如，所有大中型应用都要涉及到的持久化管理（Persistent）、事务管理（Transaction Management）、权限管理（Privilege Management）、日志管理（Logging）和调试管理（Debugging）等。使用AOP技术，可以让开发人员只专注核心业务，而通用逻辑则使用AOP技术进行横向切入，由专人去处理这些通用逻辑，会使得任务简单明了，提高开发和调试的效率。

### 二、相关专业术语
#### 增强（Advice）
**增强（也叫通知）是织入到目标类连接点上的一段程序代码**

AOP（切面编程）是用来给某一类特殊的连接点，添加一些特殊的功能，那么我们添加的功能也就是增强

比如：添加日志、管理事务。

增强不仅仅包含需要增加的功能代码而已，它还包含了方位信息。

那什么是方位信息呢？
方位信息就是相对于方法的位置信息，如：方法前、方法后、方法环绕

为什么要方位信息呢？切点不是确定了需要增强的位置了吗？

切点定位的是“在什么类的什么方法上”，也就是说，切点只是定位到了方法本身（也叫执行点，特殊的连接点），但是我们增强的内容是放在该方法的前面呢、后面呢？还是前后都要呢？这些切点却没有告诉我们，那么我们该如何确定具体位置呢？　　　　

所以，我们才需要用到方位信息，进一步的定位到具体的增强代码放置的位置。

增强即包含了【功能】又包含了【方位】，那我是不是不用切点就可以匹配哪些方法，并添加功能了呢？

确实如此，因为通过方位信息，虽然只是简单的描述了【功能】需要放在方法前、后、还是前后都要等信息，但是我们还是可以通过方位定位到位置。只不过，是匹配到所有类的所有方法！因为方位只是说明在方法前还是方法后，并没有要求是哪些类？哪些方法？ — So，我们可以直接使用增强来生成一个切面，而不需要切点，但这并不怎么推荐，因为它是匹配所有方法的。所以，我们才需要用切点来进一步确认位置。
#### 连接点（Joinpoint）
程序执行的某个特定位置：如类开始初始化前、类初始化后、类某个方法调用前、调用后、方法抛出异常后。

一个类或一段程序代码拥有一些具有边界性质的特定点，这些点中的特定点就称为“连接点”。

Spring仅支持方法的连接点，即仅能在方法调用前、方法调用后、方法抛出异常时以及方法调用前后这些程序执行点织入增强。

连接点由两个信息确定：
- 第一是用方法表示的程序执行点；
- 第二是用相对点表示的方位。

#### 切入点（Pointcut）
一个项目中有很多的类，一个类有很多个连接点，当我们需要在某个方法前插入一段增强（advice）代码时，我们就需要使用切点信息来确定，要在哪些连接点上添加增强。

那么切点是什么？
如果把连接点当做数据库中的记录，那么切点就是查找该记录的查询条件。

所以，一般我们要实现一个切点时，那么我们需要判断哪些连接点是符合我们的条件的，如：方法名是否匹配、类是否是某个类、以及子类等。
#### 切面（Aspect）
切面由切点和增强(或引介)组成，或者只由增强（或引介）实现。
#### 目标对象（Target Object）
目标对象就是我们需要对它进行增强的业务类。
如果没有AOP，那么该业务类就得自己实现需要的功能。
#### 引入（Introduction）
引介是一种特殊的增强，它为类添加一些属性和方法。这样，即使一个业务类原本没有实现某个接口，通过AOP的引介功能，我们可以动态地为该业务类添加接口的实现逻辑，让业务类成为这个接口的实现类

#### 织入（Weaving）
织入就是将增强添加到目标类具体连接点上的过程。
- 编译期织入，这要求使用特殊java编译器
- 类装载期织入，这要求使用特殊的类装载器
- 动态代理织入，在运行期为目标类添加增强生成子类的方式

Spring采用的是动态代理织入，而AspectJ采用编译期织入和类装载期织入。
#### AOP代理（AOP Proxy）
一个类被AOP织入后生成出了一个结果类，它是融合了原类和增强逻辑的代理类。